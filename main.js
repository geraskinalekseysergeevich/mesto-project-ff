/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach(function(e){n(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function n(e,r,n){return(r=function(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var o={authorization:"564bf9a9-34bf-437f-acee-6b65bc778afe","Content-Type":"application/json"},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r({headers:r(r({},o),e.headers)},e);return fetch("".concat("https://mesto.nomoreparties.co/v1/higher-front-back-dev").concat(t),n).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})},c=function(){return u("/users/me")},a=function(){return u("/cards")},i=function(t,e){return u("/users/me",{method:"PATCH",body:JSON.stringify({name:t,about:e})})},l=function(t,e){return u("/cards",{method:"POST",body:JSON.stringify({name:t,link:e})})},s=function(t){return u("/cards/".concat(t),{method:"DELETE"})},f=function(t){return u("/cards/likes/".concat(t),{method:"PUT"})},p=function(t){return u("/cards/likes/".concat(t),{method:"DELETE"})},d=function(t){return u("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:t})})};function v(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function u(r,n,o,u){var i=n&&n.prototype instanceof a?n:a,l=Object.create(i.prototype);return y(l,"_invoke",function(r,n,o){var u,a,i,l=0,s=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(r,n){for(a=r,i=n,e=0;!f&&l&&!o&&e<s.length;e++){var o,u=s[e],d=p.p,v=u[2];r>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=r<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=r<3||u[0]>n||n>v)&&(u[4]=r,u[5]=n,p.n=v,a=0))}if(o||r>1)return c;throw f=!0,n}return function(o,s,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,v),a=s,i=v;(e=a<2?t:i)||!f;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(l=2,u){if(a||(o="next"),e=u[o]){if(!(e=e.call(u,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,a<2&&(a=0)}else 1===a&&(e=u.return)&&e.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=t}else if((e=(f=p.n<0)?i:r.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{l=1}}return{value:e,done:f}}}(r,o,u),!0),l}var c={};function a(){}function i(){}function l(){}e=Object.getPrototypeOf;var s=[][n]?e(e([][n]())):(y(e={},n,function(){return this}),e),f=l.prototype=a.prototype=Object.create(s);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,y(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return i.prototype=l,y(f,"constructor",l),y(l,"constructor",i),i.displayName="GeneratorFunction",y(l,o,"GeneratorFunction"),y(f),y(f,o,"Generator"),y(f,n,function(){return this}),y(f,"toString",function(){return"[object Generator]"}),(v=function(){return{w:u,m:p}})()}function y(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}y=function(t,e,r,n){function u(e,r){y(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(u("next",0),u("throw",1),u("return",2))},y(t,e,r,n)}function m(t,e,r,n,o,u,c){try{var a=t[u](c),i=a.value}catch(t){return void r(t)}a.done?e(i):Promise.resolve(i).then(n,o)}function b(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var u=t.apply(e,r);function c(t){m(u,n,o,c,a,"next",t)}function a(t){m(u,n,o,c,a,"throw",t)}c(void 0)})}}var _=function(t,e){return e.likes.some(function(e){return e._id===t})},h=function(){var t=b(v().m(function t(e,r,n){var o,u,c,a,i;return v().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o=e.target,u=o.closest(".card").querySelector(".card__likes-count"),t.p=1,!_(r,n)){t.n=3;break}return t.n=2,p(n._id);case 2:a=t.v,t.n=5;break;case 3:return t.n=4,f(n._id);case 4:a=t.v;case 5:c=a,n.likes=c.likes,u.textContent=n.likes.length,o.classList.toggle("card__like-button_is-active",_(r,n)),t.n=7;break;case 6:t.p=6,i=t.v,console.error("Ошибка при добавлении или удалении лайка:",i);case 7:return t.a(2)}},t,null,[[1,6]])}));return function(e,r,n){return t.apply(this,arguments)}}(),S=function(){var t=b(v().m(function t(e){var r;return v().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,s(e.cardId);case 1:e.cardElement.remove(),t.n=3;break;case 2:t.p=2,r=t.v,console.error("Ошибка при удалении карточки:",r);case 3:return t.a(2)}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),g=function(t){var e=t.template,r=t.userId,n=t.cardData,o=t.openImagePopup,u=e.querySelector(".card").cloneNode(!0),c=u.querySelector(".card__image"),a=u.querySelector(".card__title"),i=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),s=u.querySelector(".card__likes-count");return c.src=n.link,c.alt=n.name,a.textContent=n.name,s.textContent=n.likes.length,l.classList.toggle("card__like-button_is-active",_(r,n)),r===n.owner._id?i.addEventListener("click",function(){u.dispatchEvent(new CustomEvent("card:delete-request",{bubbles:!0,detail:{cardElement:u,cardId:n._id}}))}):i.remove(),c.addEventListener("click",function(){return o(n.name,n.link)}),l.addEventListener("click",function(t){return h(t,r,n)}),u};function E(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",k)}function w(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",k)}function k(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&w(e)}}function O(t){t.target.classList.contains("popup")&&w(t.target)}var j=function(t,e){t.textContent=e?"Сохранение...":"Сохранить"},q=function(t,e,r,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r),o.textContent=n},P=function(t,e,r){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),n.textContent=""},L=function(t,e,r){var n=r.inputErrorClass,o="true"===e.getAttribute("data-touched");return e.validity.valid?void 0!==e.dataset.regex&&r.validationRegex&&!r.validationRegex.test(e.value)?(o&&q(t,e,n,r.errorMessage),!1):(P(t,e,n),!0):(o&&q(t,e,n,e.validationMessage),!1)},x=function(t,e,r){var n=t.querySelector(r.submitButtonSelector);!function(t,e,r){return t.some(function(t){return!L(e,t,r)})}(e,t,r)?(n.classList.remove(r.inactiveButtonClass),n.disabled=!1):(n.classList.add(r.inactiveButtonClass),n.disabled=!0)},C=function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach(function(r){P(t,r,e.inputErrorClass),r.removeAttribute("data-touched")}),x(t,r,e)};function A(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,u,c,a=[],i=!0,l=!1;try{if(u=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=u.call(r)).done)&&(a.push(n.value),a.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function D(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function u(r,n,o,u){var i=n&&n.prototype instanceof a?n:a,l=Object.create(i.prototype);return I(l,"_invoke",function(r,n,o){var u,a,i,l=0,s=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(r,n){for(a=r,i=n,e=0;!f&&l&&!o&&e<s.length;e++){var o,u=s[e],d=p.p,v=u[2];r>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=r<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=r<3||u[0]>n||n>v)&&(u[4]=r,u[5]=n,p.n=v,a=0))}if(o||r>1)return c;throw f=!0,n}return function(o,s,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,v),a=s,i=v;(e=a<2?t:i)||!f;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(l=2,u){if(a||(o="next"),e=u[o]){if(!(e=e.call(u,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,a<2&&(a=0)}else 1===a&&(e=u.return)&&e.call(u),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);u=t}else if((e=(f=p.n<0)?i:r.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{l=1}}return{value:e,done:f}}}(r,o,u),!0),l}var c={};function a(){}function i(){}function l(){}e=Object.getPrototypeOf;var s=[][n]?e(e([][n]())):(I(e={},n,function(){return this}),e),f=l.prototype=a.prototype=Object.create(s);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,I(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return i.prototype=l,I(f,"constructor",l),I(l,"constructor",i),i.displayName="GeneratorFunction",I(l,o,"GeneratorFunction"),I(f),I(f,o,"Generator"),I(f,n,function(){return this}),I(f,"toString",function(){return"[object Generator]"}),(D=function(){return{w:u,m:p}})()}function I(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}I=function(t,e,r,n){function u(e,r){I(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(u("next",0),u("throw",1),u("return",2))},I(t,e,r,n)}function G(t,e,r,n,o,u,c){try{var a=t[u](c),i=a.value}catch(t){return void r(t)}a.done?e(i):Promise.resolve(i).then(n,o)}function F(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var u=t.apply(e,r);function c(t){G(u,n,o,c,a,"next",t)}function a(t){G(u,n,o,c,a,"throw",t)}c(void 0)})}}var N=document.querySelector(".places__list"),B=document.querySelector("#card-template").content;function M(t,e){W.src=e,W.alt=t,X.textContent=t,E(V)}var J=document.querySelectorAll(".popup"),R=document.querySelector(".profile__edit-button"),z=document.querySelector(".profile__add-button"),H=document.querySelectorAll(".popup__close"),U=document.querySelector(".profile__title"),$=document.querySelector(".profile__description"),Z=document.querySelector(".profile__image"),K=document.querySelector(".popup_type_edit"),Q=document.querySelector(".popup_type_new-card"),V=document.querySelector(".popup_type_image"),W=V.querySelector(".popup__image"),X=V.querySelector(".popup__caption"),Y=document.querySelector(".popup_type_confirm-delete"),tt=document.querySelector(".popup_type_avatar"),et=document.querySelector('.popup__form[name="edit-profile"]'),rt=document.querySelector('.popup__form[name="new-place"]'),nt=Y.querySelector(".popup__form"),ot=document.querySelector('.popup__form[name="edit-avatar"]'),ut=null;N.addEventListener("card:delete-request",function(t){ut=t.detail,E(Y)});var ct={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",validationRegex:/^[a-zA-Zа-яА-ЯёЁ\- ]+$/,errorMessage:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"};!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach(function(e){!function(t,e){var r=Array.from(t.querySelectorAll(".popup__input")),n=function(){r.forEach(function(r){L(t,r,e)}),x(t,r,e)};r.forEach(function(t){t.addEventListener("input",function(){t.setAttribute("data-touched","true"),n()}),t.addEventListener("blur",function(){t.setAttribute("data-touched","true"),n()})})}(e,t)})}(ct),J.forEach(function(t){t.addEventListener("mousedown",O)}),H.forEach(function(t){t.addEventListener("click",function(){return w(t.closest(".popup"))})}),nt.addEventListener("submit",function(t){t.preventDefault(),S(ut),w(Y)}),R.addEventListener("click",function(){et.name.value=U.textContent,et.description.value=$.textContent,C(et,ct),E(K)}),et.addEventListener("submit",function(){var t=F(D().m(function t(e){var r,n,o;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.preventDefault(),r=e.submitter,j(r,!0),t.p=1,t.n=2,i(et.name.value,et.description.value);case 2:n=t.v,U.textContent=n.name,$.textContent=n.about,w(K),t.n=4;break;case 3:t.p=3,o=t.v,console.error("Ошибка при редактировании профиля:",o);case 4:return t.p=4,j(r,!1),t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}));return function(e){return t.apply(this,arguments)}}()),z.addEventListener("click",function(){rt.reset(),C(rt,ct),E(Q)}),rt.addEventListener("submit",function(){var t=F(D().m(function t(e){var r,n,o,u,c,a;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.preventDefault(),r=e.submitter,j(r,!0),n=rt["place-name"].value,o=rt.link.value,t.p=1,t.n=2,l(n,o);case 2:u=t.v,c=g({template:B,userId:at,cardData:u,openImagePopup:M}),N.prepend(c),w(Q),rt.reset(),t.n=4;break;case 3:t.p=3,a=t.v,console.error("Ошибка при добавлении карточки:",a);case 4:return t.p=4,j(r,!1),t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}));return function(e){return t.apply(this,arguments)}}()),Z.addEventListener("click",function(){ot.reset(),C(ot,ct),E(tt)}),ot.addEventListener("submit",function(){var t=F(D().m(function t(e){var r,n,o,u;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.preventDefault(),r=ot.avatar.value,n=e.submitter,j(n,!0),t.p=1,t.n=2,d(r);case 2:o=t.v,Z.style.backgroundImage="url(".concat(o.avatar,")"),w(tt),ot.reset(),t.n=4;break;case 3:t.p=3,u=t.v,console.error("Ошибка при обновлении аватара:",u);case 4:return t.p=4,j(n,!1),t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}));return function(e){return t.apply(this,arguments)}}());var at=null;!function(){var t=F(D().m(function t(){var e,r,n,o,u;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Promise.all([c(),a()]);case 1:e=t.v,r=A(e,2),n=r[0],o=r[1],at=n._id,U.textContent=n.name,$.textContent=n.about,Z.dataset.avatar=n.avatar,Z.style.backgroundImage="url(".concat(n.avatar,")"),o.forEach(function(t){var e=g({template:B,userId:at,cardData:t,openImagePopup:M});N.append(e)}),t.n=3;break;case 2:t.p=2,u=t.v,console.error(u);case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}()()})();